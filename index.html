<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V Share - Login</title>
    
    <style>
        /* CSS starts here */
        body {
            font-family: sans-serif;
            margin: 0;
            background-color: #f4f4f9;
            color: #333;
        }

        header {
            background-color: #007bff;
            color: white;
            padding: 1rem;
            text-align: center;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 {
            margin: 0;
        }
        
        header #user-info {
            display: flex;
            align-items: center;
        }

        nav a {
            color: white;
            margin: 0 10px;
            text-decoration: none;
        }
        
        #logout-btn {
            background: none;
            color: white;
            border: 1px solid white;
            padding: 5px 10px;
            cursor: pointer;
            margin-left: 20px;
        }

        main {
            padding: 2rem;
            max-width: 900px;
            margin: 0 auto;
        }

        .voucher-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .voucher-card {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .voucher-card h3 {
            margin-top: 0;
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        input, select, button {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 1rem;
        }

        button {
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 10px;
        }

        .buy-button {
            background-color: #28a745;
        }
        
        .sold-text {
            color: #dc3545;
            font-weight: bold;
        }
        
        /* Login Page Styling */
        #login-section {
            max-width: 400px;
            margin: 100px auto;
            text-align: center;
        }
        
        #login-section form {
            background-color: #fff;
            padding: 30px;
        }
        
        #login-error {
            color: red;
            margin-top: 10px;
            display: none;
        }

        /* Modal Styling */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto; /* 5% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 80%; /* Could be more or less, depending on screen size */
            max-width: 600px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        
        #voucher-image {
            max-width: 100%;
            height: auto;
            margin-top: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        /* CSS ends here */
    </style>
</head>
<body>

    <div id="login-section">
        <h2>V Share Login</h2>
        <p>Use "user1" or "user2" with password "password" to log in.</p>
        <form id="login-form">
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" required>
            
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required>
            
            <button type="submit">Log In</button>
            <p id="login-error">Invalid username or password.</p>
        </form>
    </div>

    <div id="app-container" style="display: none;">
        <header>
            <h1>V Share</h1>
            <div id="user-info">
                <nav>
                    <a href="#available-vouchers-section">Available Vouchers</a>
                    <a href="#my-vouchers-section">My Vouchers</a>
                    <a href="#add-voucher-section">Add Voucher</a>
                </nav>
                <button id="logout-btn" onclick="handleLogout()">Logout</button>
            </div>
        </header>

        <main>
            <section id="available-vouchers-section">
                <h2>Available Vouchers for Sale</h2>
                <div id="voucher-list" class="voucher-container">
                    </div>
            </section>

            <hr>

            <section id="my-vouchers-section">
                <h2>My Vouchers</h2>
                <div id="my-voucher-list" class="voucher-container">
                    </div>
            </section>

            <hr>

            <section id="add-voucher-section">
                <h2>Add a New Voucher</h2>
                <form id="add-voucher-form">
                    <label for="voucher-type">Voucher Type:</label>
                    <select id="voucher-type" name="voucher-type" required>
                        <option value="">Select a type...</option>
                        <option value="Food">Food Voucher</option>
                        <option value="Travel">Travel Voucher</option>
                        <option value="Electronics">Electronics Gadgets Voucher</option>
                        <option value="Specs">Specs Voucher</option>
                        <option value="Other">Other</option>
                    </select>
                    
                    <label for="voucher-code">Voucher Code:</label>
                    <input type="text" id="voucher-code" name="voucher-code" required>

                    <label for="voucher-file">Upload Voucher Soft Copy:</label>
                    <input type="file" id="voucher-file" name="voucher-file" accept="image/*,.pdf" required>

                    <button type="submit">Submit Voucher</button>
                </form>
            </section>
        </main>
    </div>

    <div id="voucher-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <h2 id="modal-title"></h2>
            <p><strong>Type:</strong> <span id="modal-type"></span></p>
            <p><strong>Code:</strong> <span id="modal-code"></span></p>
            <p><strong>Seller:</strong> <span id="modal-seller"></span></p>
            <hr>
            <h3>Soft Copy</h3>
            <img id="voucher-image" src="#" alt="Voucher Soft Copy">
        </div>
    </div>

    <script>
        /* JavaScript starts here */
        const users = [
            { id: 'user1', username: 'user1', password: 'password' },
            { id: 'user2', username: 'user2', password: 'password' },
            { id: 'user3', username: 'user3', password: 'password' }
        ];

        let vouchers = [
            { id: '1', type: 'Food', code: 'FOODIE123', imageUrl: 'https://via.placeholder.com/400x200?text=Food+Voucher', sellerId: 'user2', status: 'available' },
            { id: '2', type: 'Travel', code: 'TRIP2025', imageUrl: 'https://via.placeholder.com/400x200?text=Travel+Voucher', sellerId: 'user3', status: 'available' },
            { id: '3', type: 'Electronics', code: 'GADGET20', imageUrl: 'https://via.placeholder.com/400x200?text=Electronics+Voucher', sellerId: 'user1', status: 'available' },
            { id: '4', type: 'Food', code: 'TASTY50', imageUrl: 'https://via.placeholder.com/400x200?text=Acquired+Voucher', sellerId: 'user3', status: 'sold', ownerId: 'user1' },
        ];

        let currentUser = null;

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            
            const addVoucherForm = document.getElementById('add-voucher-form');
            if (addVoucherForm) {
                addVoucherForm.addEventListener('submit', handleFormSubmission);
            }
            
            handleLogout();
        });

        function handleLogin(event) {
            event.preventDefault();
            
            const usernameInput = document.getElementById('username').value;
            const passwordInput = document.getElementById('password').value;
            
            const user = users.find(u => u.username === usernameInput && u.password === passwordInput);
            
            if (user) {
                currentUser = user;
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('app-container').style.display = 'block';
                
                displayVouchers();
                displayMyVouchers();
            } else {
                document.getElementById('login-error').style.display = 'block';
            }
        }
        
        function handleLogout() {
            currentUser = null;
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('app-container').style.display = 'none';
            document.getElementById('login-form').reset();
            document.getElementById('login-error').style.display = 'none';
        }

        async function handleFormSubmission(event) {
            event.preventDefault();
            
            const form = event.target;
            const voucherType = form['voucher-type'].value;
            const voucherCode = form['voucher-code'].value;
            const voucherFile = form['voucher-file'].files[0];

            if (!voucherFile) {
                alert('Please upload a file.');
                return;
            }

            // Read the uploaded file as a Data URL
            const imageDataUrl = await new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.readAsDataURL(voucherFile);
            });

            const newVoucher = {
                id: (vouchers.length + 1).toString(),
                type: voucherType,
                code: voucherCode,
                imageUrl: imageDataUrl, // Store the Data URL here
                sellerId: currentUser.id,
                status: 'available'
            };
            vouchers.push(newVoucher);

            alert('Voucher submitted successfully! It is now available for other users to buy.');
            
            displayVouchers();
            displayMyVouchers();
            
            form.reset();
        }

        function displayVouchers() {
            const voucherListContainer = document.getElementById('voucher-list');
            if (!voucherListContainer || !currentUser) return;

            voucherListContainer.innerHTML = '';
            const availableVouchers = vouchers.filter(v => v.status === 'available' && v.sellerId !== currentUser.id);

            if (availableVouchers.length === 0) {
                voucherListContainer.innerHTML = '<p>No vouchers are currently available for purchase.</p>';
            } else {
                availableVouchers.forEach(voucher => {
                    const card = document.createElement('div');
                    card.className = 'voucher-card';
                    card.innerHTML = `
                        <h3>${voucher.type} Voucher</h3>
                        <p>Code: ${voucher.code}</p>
                        <p>Seller: ${voucher.sellerId}</p>
                        <button onclick="viewVoucher('${voucher.id}')">View Details</button>
                        <button class="buy-button" onclick="buyVoucher('${voucher.id}')">Buy Voucher</button>
                    `;
                    voucherListContainer.appendChild(card);
                });
            }
        }

        function displayMyVouchers() {
            const myVoucherListContainer = document.getElementById('my-voucher-list');
            if (!myVoucherListContainer || !currentUser) return;

            myVoucherListContainer.innerHTML = '';
            const myVouchers = vouchers.filter(v => v.sellerId === currentUser.id || v.ownerId === currentUser.id);

            if (myVouchers.length === 0) {
                myVoucherListContainer.innerHTML = '<p>You do not own any vouchers yet.</p>';
            } else {
                myVouchers.forEach(voucher => {
                    const card = document.createElement('div');
                    card.className = 'voucher-card';
                    let statusText = '';
                    if (voucher.sellerId === currentUser.id && voucher.status === 'available') {
                        statusText = '<p class="sold-text">Status: Listed for Sale</p>';
                    } else if (voucher.ownerId === currentUser.id) {
                        statusText = '<p class="sold-text">Status: Acquired</p>';
                    } else if (voucher.sellerId === currentUser.id && voucher.status === 'sold') {
                        statusText = '<p class="sold-text">Status: Sold</p>';
                    }

                    card.innerHTML = `
                        <h3>${voucher.type} Voucher</h3>
                        <p>Code: ${voucher.code}</p>
                        ${statusText}
                        <button onclick="viewVoucher('${voucher.id}')">View Details</button>
                    `;
                    myVoucherListContainer.appendChild(card);
                });
            }
        }
        
        function viewVoucher(voucherId) {
            const voucher = vouchers.find(v => v.id === voucherId);
            if (!voucher) {
                alert('Voucher not found.');
                return;
            }

            document.getElementById('modal-title').textContent = `${voucher.type} Details`;
            document.getElementById('modal-type').textContent = voucher.type;
            document.getElementById('modal-code').textContent = voucher.code;
            document.getElementById('modal-seller').textContent = voucher.sellerId;
            
            // Set the image source
            const voucherImage = document.getElementById('voucher-image');
            // Check if the URL is a Data URL or a regular URL
            if (voucher.imageUrl.startsWith('data:')) {
                voucherImage.src = voucher.imageUrl;
            } else {
                voucherImage.src = voucher.imageUrl;
            }

            document.getElementById('voucher-modal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('voucher-modal').style.display = 'none';
        }

        function buyVoucher(voucherId) {
            if (!currentUser) {
                alert('You must be logged in to buy vouchers.');
                return;
            }
            
            const voucherIndex = vouchers.findIndex(v => v.id === voucherId);
            
            if (voucherIndex !== -1) {
                const voucher = vouchers[voucherIndex];
                
                alert(`You are buying the ${voucher.type} voucher with code: ${voucher.code}. (This is a simulation)`);
                
                voucher.status = 'sold';
                voucher.ownerId = currentUser.id;
                
                displayVouchers();
                displayMyVouchers();
                
                alert('Voucher purchased successfully! Check your "My Vouchers" section.');
            } else {
                alert('Voucher not found.');
            }
        }
        
        // Close modal when clicking outside of it
        window.onclick = function(event) {
            const modal = document.getElementById('voucher-modal');
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
        /* JavaScript ends here */
    </script>
</body>
</html>